[
  {
    "kind": 2,
    "language": "sparql",
    "value": "\nSELECT DISTINCT ?graph\nWHERE {\n  GRAPH ?graph { ?s ?p ?o }\n}\n\n# PREFIX kfs: <ark:/87287/d7gt0q/>\n# PREFIX ae: <ark:/87287/d7c08j/>\n# PREFIX ucdlib: <http://schema.library.ucdavis.edu/schema#>\n# PREFIX vivo: <http://vivoweb.org/ontology/core#>\n\n\n#SELECT * \n# DESCRIBE ?s #?from_grant\n# WHERE {\n#   GRAPH ae: { ?s a vivo:Grant ;\n#               # ucdlib:flowThruFunding ?flowThruFunding ;\n#                    ?p ?o\n#               }\n#    }\n#   # GRAPH kfs: { ?s a vivo:Grant ?p ?o }\n# LIMIT 3\n",
    "metadata": {}
  },
  {
    "kind": 1,
    "language": "markdown",
    "value": "",
    "metadata": {}
  },
  {
    "kind": 2,
    "language": "sparql",
    "value": "# Query for grants\n\nPREFIX : <ark:/87287/d7gt0q/schema#>\nPREFIX ae: <ark:/87287/d7c08j/>\nPREFIX iam: <http://iam.ucdavis.edu/>\nPREFIX experts: <http://experts.ucdavis.edu/>\nPREFIX grant: <ark:/87287/d7gt0q/grant/>\nPREFIX kfs: <ark:/87287/d7gt0q/>\nPREFIX obo: <http://purl.obolibrary.org/obo/>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX ucdlib: <http://schema.library.ucdavis.edu/schema#>\nPREFIX vivo: <http://vivoweb.org/ontology/core#>\nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX cdl: <http://oapolicy.universityofcalifornia.edu/>\nselect distinct\n(?grant AS ?id)\n(\"grant\" AS ?category)\n(\"c-davis\" AS ?type)\n(\"\" AS ?url)\n?institution_reference\n?flowThruFunding\n?title\n?pi\n?funding_type\n?start_date\n?end_date\n?ucop_sponsor\n(?funder AS ?funder_name)\n(?reference AS ?funder_reference)\n(?amount AS ?amount_value)\n(\"USD\" AS ?amount_currency_code)\n(\"TRUE\" AS ?visible)\n#select ?grant ?cas ?e_role ?title ?start_date ?end_date ?funder ?reference ?amount ?amt_type\n#DESCRIBE ?grant\nwhere {\n   VALUES (?role ?link_type_id ?e_role) {\n       (:GrantCoPrincipalInvestigatorRole \"121\" \"Co-PI of\")\n       (:GrantPrincipalInvestigatorRole \"120\" \"Primary investigator for\")\n     }\n  GRAPH kfs: {\n  ?grant a vivo:Grant;\n        #  ucdlib:grantType/rdfs:label ?funding_type;\n         rdfs:label ?title;\n         ucdlib:piName ?pi;\n         vivo:dateTimeInterval [\n                                 vivo:start/vivo:dateTime ?start_date;\n                                 vivo:end/vivo:dateTime ?end_date;\n                               ];\n\n       vivo:relates [\n            a ?role;\n                 a :GrantPrincipalInvestigatorRole;\n                 obo:RO_0000052 ?expert;\n               ];\n      .\n  OPTIONAL {\n    ?grant ucdlib:flowThruFunding ?ftf;\n    bind(uri(replace(str(?ftf),\"ark:/87287/d7gt0q/funding_org/\",\"http://rems.ucop.edu/sponsor/\")) as ?flowThruFunding)\n  }\n  # OPTIONAL {\n  #       ?grant ucdlib:grantType/rdfs:label ?funding_type;\n  # }\n\n  OPTIONAL {\n    ?grant vivo:assignedBy ?sponsor;\n           vivo:sponsorAwardId ?reference;\n           .\n      ?sponsor rdfs:label ?funder;\n           .\n      bind(uri(replace(str(?sponsor),\"ark:/87287/d7gt0q/funding_org/\",\"http://rems.ucop.edu/sponsor/\")) as ?ucop_sponsor)\n  }\n  OPTIONAL {\n    ?grant vivo:totalAwardAmount ?amount\n    .\n     filter(xsd:decimal(?amount) > 0)\n  }\n  }\n  filter not exists {\n    ?grant ucdlib:oracle_award_nbr ?oracle;\n           .\n  }\n  OPTIONAL {\n  graph iam: {\n    ?expert ucdlib:userId ?cas.\n  }\n\n  GRAPH cdl: {\n      ?expert ucdlib:proprietary_id ?ucpath .\n    }\n  }\n  BIND (?grant AS ?institution_reference) .\n} \n\n# order by ?grant\n\nlimit 100\n",
    "metadata": {}
  },
  {
    "kind": 2,
    "language": "sparql",
    "value": "PREFIX : <ark:/87287/d7gt0q/>\nselect  ?g ?type (count(*) as ?cnt)\nWHERE {\n  graph ?g {\n    [] a $type.\n   }\n  filter(regex(str(?g),\"^ark:\"))\n} group by ?g ?type order by ?g ?type",
    "metadata": {}
  },
  {
    "kind": 2,
    "language": "sparql",
    "value": "# Query for Grant CDL User links.\n\nPREFIX : <ark:/87287/d7gt0q/schema#>\nPREFIX experts: <http://experts.ucdavis.edu/>\nPREFIX grant: <ark:/87287/d7gt0q/grant/>\nPREFIX kfs: <ark:/87287/d7gt0q/>\nPREFIX obo: <http://purl.obolibrary.org/obo/>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX ucdlib: <http://schema.library.ucdavis.edu/schema#>\nPREFIX vivo: <http://vivoweb.org/ontology/core#>\nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX iam: <http://iam.ucdavis.edu/>\nPREFIX cdl: <http://oapolicy.universityofcalifornia.edu/>\n\nselect ?category_1 ?id_1 ?category_2 ?id_2 ?link_type_id (\"TRUE\" as ?visible)\n  WHERE {\n    VALUES (?role ?link_type_id ?e_role) {\n#       (:GrantAccountManagerRole \"183\" \"Researcher on\" )\n       (:GrantOtherRole \"138\" \"Researcher on\" )\n       (:GrantProjectLeaderRole \"118\" \"Project Lead of\")\n       (:GrantCoPrincipalInvestigatorRole \"121\" \"Co-PI of\")\n       (:GrantProgramDirectorRole \"137\" \"Program Director of\")\n       (:GrantCoreLeaderRole \"119\" \"Co leader on\")\n       (:GrantKeyPersonnelRole \"97\" \"Senior personal of\")\n       (:GrantPrincipalInvestigatorRole \"120\" \"Primary investigator for\")\n     }\n\n    GRAPH kfs: {\n        ?grant a vivo:Grant;\n               vivo:relates [ a :GrantPrincipalInvestigatorRole;\n               obo:RO_0000052 ?pi];\n               vivo:relates ?related\n               .\n   \t?related a ?role ;\n               obo:RO_0000052 ?expert;\n               .\n\n  }\n\n  graph iam: {\n\t  ?expert ucdlib:userId ?cas.\n\n  \t}\n\n\n  GRAPH cdl: {\n\t    ?expert ucdlib:proprietary_id ?ucpath .\n    }\n\n      bind(\"user\" as ?category_1)\n      bind(\"grant\" as ?category_2)\n      bind(?ucpath as ?id_1)\n      bind(?grant as ?id_2)\n  }\n\nlimit 100\n",
    "metadata": {}
  },
  {
    "kind": 2,
    "language": "sparql",
    "value": "# Query for grant roles\n\nPREFIX : <ark:/87287/d7gt0q/schema#>\nPREFIX experts: <http://experts.ucdavis.edu/>\nPREFIX grant: <ark:/87287/d7gt0q/grant/>\nPREFIX kfs: <ark:/87287/d7gt0q/>\nPREFIX obo: <http://purl.obolibrary.org/obo/>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX ucdlib: <http://schema.library.ucdavis.edu/schema#>\nPREFIX vivo: <http://vivoweb.org/ontology/core#>\nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX iam: <http://iam.ucdavis.edu/>\nPREFIX cdl: <http://oapolicy.universityofcalifornia.edu/>\n\nselect ?category ?id ?field_name ?surname ?first_name ?full_name ?order_number ?email_address ?phone_number ?full_address ?address_name\n  WHERE {\n    VALUES (?role ?link_type_id ?e_role) {\n       (:GrantCoPrincipalInvestigatorRole \"121\" \"Co-PI of\")\n       (:GrantPrincipalInvestigatorRole \"120\" \"Primary investigator for\")\n     }\n\n    GRAPH kfs: {\n        ?grant a vivo:Grant;\n               vivo:relates ?related\n               .\n   \t    ?related a ?role;\n               rdfs:label ?full_name_and_role;\n               obo:RO_0000052 ?expert;\n               .\n    }\n\n  \nOptional {\n  graph iam: {\n\t  ?expert ucdlib:userId ?cas.\n\n  \t}\n  }\n  \n  bind(\"grant\" as ?category)\n  bind(?grant as ?id)\n\tbind(\"researchers\" as ?field_name)\n  bind(replace(?full_name_and_role,\"\\\\(.*\\\\)\" ,\"\") as ?temp)\n  bind(replace(STRBEFORE(?temp,\" \"),\",\" ,\"\") as ?surname)\n  bind(replace(STRAFTER(?temp,\" \"),\",\" ,\"\") as ?first_name)\n  bind(?temp as ?full_name)\n  bind(concat(?cas,\"@ucdavis.edu\") as ?email_address)\n  }\n\nlimit 5\n",
    "metadata": {}
  }
]